(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{489:(e,r,t)=>{"use strict";t.d(r,{nc:()=>o,Wn:()=>i}),t(7652);var s=t(5453),a=t(4309);let o=(0,s.v)((e,r)=>({user:null,accessToken:null,refreshToken:null,setSession:(r,t)=>{t&&(a.HM.setAccess(t),localStorage.setItem("token",t)),e({user:r,accessToken:t,refreshToken:null})},clearSession:()=>{a.HM.clearAccess(),a.HM.clearRefresh(),localStorage.removeItem("token"),t.e(135).then(t.bind(t,9135)).then(e=>{e.useCartStore.getState().clearUserData()}),t.e(628).then(t.bind(t,3628)).then(e=>{e.useLikeStore.getState().clearUserData()}),e({user:null,accessToken:null,refreshToken:null})},isAuthed:()=>!!(r().user||a.HM.getAccess())}));{let e=localStorage.getItem("token");e&&o.setState({accessToken:e})}var l=t(5695);function i(){let e=o(e=>e.clearSession),r=(0,l.useRouter)();return()=>{e(),r.push("/login")}}},2840:(e,r,t)=>{Promise.resolve().then(t.bind(t,9690))},3628:(e,r,t)=>{"use strict";t.r(r),t.d(r,{useLikeStore:()=>l});var s=t(5453),a=t(6786),o=t(3568);let l=(0,s.v)()((0,a.Zr)((e,r)=>({items:[],requireAuth:e=>!!localStorage.getItem("token")||(null==e||e(),!1),addToLikes:async(t,s)=>{if(r().requireAuth(s))try{await (0,o.yV)(t.id,t.selectedColor,t.selectedSize),e(e=>e.items.find(e=>e.id===t.id&&e.selectedColor===t.selectedColor&&e.selectedSize===t.selectedSize)?e:{items:[...e.items,t]})}catch(r){console.error("Add to favorites failed:",r),e(e=>e.items.find(e=>e.id===t.id&&e.selectedColor===t.selectedColor&&e.selectedSize===t.selectedSize)?e:{items:[...e.items,t]})}},removeFromLikes:async(r,t,s)=>{try{await (0,o.Op)(r,t,s)}catch(e){console.error("Remove from favorites failed:",e)}e(e=>({items:e.items.filter(e=>e.id!==r||e.selectedColor!==t||e.selectedSize!==s)}))},clearLikes:()=>{e({items:[]})},clearUserData:()=>{e({items:[]})},loadUserFavorites:async()=>{if(r().requireAuth())try{let r=await (0,o.bW)();e({items:r||[]})}catch(e){console.error("Load user favorites failed:",e)}},getTotalItems:()=>localStorage.getItem("token")?r().items.length:0,isItemLiked:(e,t,s)=>r().items.some(r=>r.id===e&&r.selectedColor===t&&r.selectedSize===s)}),{name:(e=>{{let r=localStorage.getItem("token");if(r)try{let t=JSON.parse(atob(r.split(".")[1]));return"".concat(e,"-").concat(t.sub||t.id||"anonymous")}catch(e){}}return"".concat(e,"-anonymous")})("shopease-likes"),storage:(0,a.KU)(()=>localStorage)}))},4309:(e,r,t)=>{"use strict";t.d(r,{rO:()=>a,FH:()=>o,GT:()=>i,HM:()=>l});var s=t(3464);let a={favorites:"/api/User/Favorites",cart:"/api/User/Cart",addToFavorites:"/api/User/Favorites/Add",removeFromFavorites:"/api/User/Favorites/Remove",addToCart:"/api/User/Cart/Add",removeFromCart:"/api/User/Cart/Remove",updateCartQuantity:"/api/User/Cart/Update"},o=s.A.create({baseURL:"https://eticaretapi-gghdgef9bzameteu.switzerlandnorth-01.azurewebsites.net/api",withCredentials:!1,headers:{"Content-Type":"application/json",Accept:"application/json"}});o.interceptors.request.use(e=>{let r=localStorage.getItem("token");if(r){var t;e.headers=null!=(t=e.headers)?t:{},e.headers.Authorization="Bearer ".concat(r)}return e},e=>Promise.reject(e)),o.interceptors.response.use(e=>e,e=>{var r;return(null==(r=e.response)?void 0:r.status)===401&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject(e)});let l={getAccess:()=>localStorage.getItem("token"),setAccess:e=>{localStorage.setItem("token",e)},clearAccess:()=>{localStorage.removeItem("token")},getRefresh:()=>null,setRefresh:()=>{},clearRefresh:()=>{}},i=e=>new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY"}).format(e)},5695:(e,r,t)=>{"use strict";var s=t(8999);t.o(s,"useRouter")&&t.d(r,{useRouter:function(){return s.useRouter}})},7652:(e,r,t)=>{"use strict";t.d(r,{MI:()=>S,UB:()=>y});var s=t(4309);let{Axios:a,AxiosError:o,CanceledError:l,isCancel:i,CancelToken:n,VERSION:c,all:d,Cancel:u,isAxiosError:m,spread:h,toFormData:f,AxiosHeaders:g,HttpStatusCode:p,formToJSON:v,getAdapter:k,mergeConfig:w}=t(3464).A,S=async(e,r)=>{try{let t=await s.FH.post("/Auth/login",{email:e,password:r});if(!t.data.success)throw Error(t.data.message||"Login failed");return t.data}catch(e){if(console.error("Login API Error:",e),e instanceof o){var t,a;if(null==(a=e.response)||null==(t=a.data)?void 0:t.message)throw Error(e.response.data.message)}if(e instanceof Error)throw Error(e.message||"Network error occurred");throw Error("Network error occurred")}},y=async e=>{try{let r=await s.FH.post("/Auth/register",e);if(!r.data.success)throw Error(r.data.message||"Register failed");return r.data}catch(e){if(console.error("Register API Error:",e),e instanceof o){var r,t;if(null==(t=e.response)||null==(r=t.data)?void 0:r.message)throw Error(e.response.data.message)}if(e instanceof Error)throw Error(e.message||"Network error occurred");throw Error("Network error occurred")}}},9690:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>m});var s=t(5155),a=t(2115),o=t(5695),l=t(6874),i=t.n(l),n=t(7652),c=t(489),d=t(9135),u=t(3628);function m(){let e=(0,o.useRouter)(),r=(0,c.nc)(e=>e.setSession),t=(0,d.useCartStore)(e=>e.loadUserCart),l=(0,u.useLikeStore)(e=>e.loadUserFavorites),[m,h]=(0,a.useState)({email:"",password:""}),[f,g]=(0,a.useState)(!1),[p,v]=(0,a.useState)(null),k=async s=>{if(s.preventDefault(),!f){g(!0),v("");try{var a,o,i,c;let s=await (0,n.MI)(m.email,m.password);if(console.log("Login result:",s),s.success&&(null==(a=s.token)?void 0:a.accessToken)){localStorage.setItem("token",s.token.accessToken);let a={id:s.userId||"",email:m.email,firstName:null==(o=s.user)?void 0:o.firstName,lastName:null==(i=s.user)?void 0:i.lastName,roles:(null==(c=s.user)?void 0:c.roles)||[]};r(a,s.token.accessToken);try{await Promise.all([t(),l()])}catch(e){console.error("Failed to load user data:",e)}e.push("/account")}else v(s.message||"Login failed")}catch(e){console.error("Login error:",e),v(e instanceof Error?e.message:"Login failed")}finally{g(!1)}}};return(0,s.jsxs)("div",{className:"container max-w-md py-12",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Giriş Yap"}),(0,s.jsxs)("form",{onSubmit:k,className:"space-y-4",children:[(0,s.jsx)("input",{type:"email",placeholder:"E-posta",className:"w-full border p-3 rounded",value:m.email,onChange:e=>h({...m,email:e.target.value}),required:!0}),(0,s.jsx)("input",{type:"password",placeholder:"Şifre",className:"w-full border p-3 rounded",value:m.password,onChange:e=>h({...m,password:e.target.value}),required:!0}),p&&(0,s.jsx)("p",{className:"text-red-600 text-sm",children:p}),(0,s.jsx)("button",{type:"submit",disabled:f,className:"w-full bg-black text-white py-3 rounded hover:bg-gray-800",children:f?"G\xf6nderiliyor...":"Giriş Yap"})]}),(0,s.jsxs)("p",{className:"mt-4 text-sm",children:["Hesabın yok mu? ",(0,s.jsx)(i(),{href:"/register",className:"underline",children:"Kayıt ol"})]})]})}}},e=>{e.O(0,[873,135,441,964,358],()=>e(e.s=2840)),_N_E=e.O()}]);